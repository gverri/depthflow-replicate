build:
 gpu: true
 python_version: '3.10'
 system_packages:
  - libgl1-mesa-glx
  - libegl1-mesa
  - libegl1-mesa-dev
  - libglvnd-dev
  - libglvnd0
 python_requirements: requirements.txt
 run:
  - command: pip install --upgrade pip setuptools wheel
    help: Upgrade base tools

  - command: pip install moderngl==5.8.2 glcontext==2.5.0 PyOpenGL
    help: Install minimal moderngl dependencies

  - command: mkdir -p /usr/share/glvnd/egl_vendor.d && echo '{"file_format_version":"1.0.0","ICD":{"library_path":"libEGL_nvidia.so.0"}}' > /usr/share/glvnd/egl_vendor.d/10_nvidia.json
    help: Configure NVIDIA GPU OpenGL acceleration in headless environment

  - command: export NVIDIA_VISIBLE_DEVICES=all NVIDIA_DRIVER_CAPABILITIES=all
    help: Set NVIDIA environment variables

predict: 'predict.py:Predictor'

image: 'r8.im/gverri/depthflow' # Replace with your Replicate username
